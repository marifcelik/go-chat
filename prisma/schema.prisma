generator client {
  provider = "go run github.com/steebchen/prisma-client-go"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String               @id @default(cuid()) @db.VarChar(50)
  name               String               @db.VarChar(255)
  username           String               @unique @db.VarChar(255)
  password           String
  sended             UserMessage[]        @relation("sender")
  received           UserMessage[]        @relation("receiver")
  groups             Group[]
  groupMessages      GroupMessage[]
  GroupMessageSeenBy GroupMessageSeenBy[]
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
}

model UserMessage {
  id         String   @id @default(cuid()) @db.VarChar(50)
  text       String
  seen       Boolean  @default(false)
  sender     User     @relation("sender", fields: [senderId], references: [id])
  senderId   String   @db.VarChar(50)
  receiver   User?    @relation("receiver", fields: [receiverId], references: [id])
  receiverId String?  @db.VarChar(50)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Group {
  id        String         @id @default(cuid()) @db.VarChar(50)
  name      String         @db.VarChar(255)
  users     User[]
  messages  GroupMessage[]
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
}

model GroupMessage {
  id                 String               @id @default(cuid()) @db.VarChar(50)
  text               String
  sender             User                 @relation(fields: [senderId], references: [id])
  senderId           String               @db.VarChar(50)
  Group              Group                @relation(fields: [groupId], references: [id])
  groupId            String               @db.VarChar(50)
  GroupMessageSeenBy GroupMessageSeenBy[]
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
}

model GroupMessageSeenBy {
  id             String       @id @default(cuid()) @db.VarChar(50)
  groupMessage   GroupMessage @relation(fields: [groupMessageId], references: [id])
  groupMessageId String       @db.VarChar(50)
  user           User         @relation(fields: [userId], references: [id])
  userId         String       @db.VarChar(50)
  seenAt         DateTime?

  @@index([groupMessageId, userId])
}
